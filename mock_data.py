# Extended product database with more items and stores
PRODUCT_DATA = {
    "iphone 15": [
        {"store": "Apple Store", "price": 79999.00, "image": "https://store.storeimages.cdn-apple.com/4668/as-images.apple.com/is/iphone-15-pro-finish-select-202309-6-7inch_GEO_EMEA?wid=5120&hei=2880&fmt=p-jpg", "category": "phone", "brand": "Apple", "description": "iPhone 15 Pro 128GB - Natural Titanium"},
        {"store": "Amazon", "price": 78999.00, "image": "https://m.media-amazon.com/images/I/81+GIkwqF8L._SL1500_.jpg", "category": "phone", "brand": "Apple", "description": "iPhone 15 Pro (128 GB) - Natural Titanium"},
        {"store": "Flipkart", "price": 77999.00, "image": "https://rukminim2.flixcart.com/image/832/832/xif0q/mobile/h/d/d/-original-imagtc4hvgrmpybn.jpeg", "category": "phone", "brand": "Apple", "description": "APPLE iPhone 15 Pro (Natural Titanium, 128 GB)"},
        {"store": "Reliance Digital", "price": 78499.00, "image": "https://www.reliancedigital.in/medias/Apple-iPhone-15-Pro-Max-Product-1-1.jpg", "category": "phone", "brand": "Apple", "description": "Apple iPhone 15 Pro 128GB Natural Titanium"}
    ],
    "iphone 14": [
        {"store": "Apple Store", "price": 69999.00, "image": "https://store.storeimages.cdn-apple.com/4668/as-images.apple.com/is/iphone-14-finish-select-202209-6-1inch-blue?wid=5120&hei=2880&fmt=p-jpg", "category": "phone", "brand": "Apple", "description": "iPhone 14 128GB - Blue"},
        {"store": "Amazon", "price": 68999.00, "image": "https://m.media-amazon.com/images/I/61bK6PMOC3L._SL1500_.jpg", "category": "phone", "brand": "Apple", "description": "iPhone 14 (128 GB) - Blue"},
        {"store": "Flipkart", "price": 67999.00, "image": "https://rukminim2.flixcart.com/image/832/832/xif0q/mobile/3/5/l/-original-imaghx9qmgqsk9s4.jpeg", "category": "phone", "brand": "Apple", "description": "APPLE iPhone 14 (Blue, 128 GB)"},
        {"store": "Reliance Digital", "price": 68499.00, "image": "https://www.reliancedigital.in/medias/Apple-iPhone-14-Mobile-Phone-493177797-i-1-1200Wx1200H.jpg", "category": "phone", "brand": "Apple", "description": "Apple iPhone 14 128GB Blue"}
    ],
    "samsung galaxy s24": [
        {"store": "Amazon", "price": 89999.00, "image": "https://m.media-amazon.com/images/I/71MCbwDy6IL._SL1500_.jpg", "category": "phone", "brand": "Samsung", "description": "Samsung Galaxy S24 Ultra 5G (Titanium Gray, 12GB, 256GB)"},
        {"store": "Flipkart", "price": 88999.00, "image": "https://rukminim2.flixcart.com/image/832/832/xif0q/mobile/g/t/u/-original-imagx4wcxwqhvyfk.jpeg", "category": "phone", "brand": "Samsung", "description": "SAMSUNG Galaxy S24 Ultra 5G (Titanium Gray, 256 GB)"},
        {"store": "Reliance Digital", "price": 89499.00, "image": "https://www.reliancedigital.in/medias/Samsung-Galaxy-S24-Ultra-Mobile-Phone-494467599-i-1-1200Wx1200H.jpg", "category": "phone", "brand": "Samsung", "description": "Samsung Galaxy S24 Ultra 5G 256GB Titanium Gray"},
        {"store": "Croma", "price": 89499.00, "image": "https://media-ik.croma.com/prod/https://media.croma.com/image/upload/v1705461738/Croma%20Assets/Communication/Mobiles/Images/302021_0_p7ceiz.png", "category": "phone", "brand": "Samsung", "description": "Samsung Galaxy S24 Ultra (12GB RAM, 256GB, Titanium Gray)"}
    ],
    "oppo find x7": [
        {"store": "Amazon", "price": 54999.00, "image": "https://m.media-amazon.com/images/I/61kO-A1zx0L._SL1500_.jpg", "category": "phone", "brand": "Oppo", "description": "OPPO Find X7 Ultra 5G (Black, 12GB, 256GB)"},
        {"store": "Flipkart", "price": 53999.00, "image": "https://rukminim2.flixcart.com/image/832/832/mobile/z/n/7/oppo-find-x7-ultra-original-imaeqgzzzmpyzmyh.jpeg", "category": "phone", "brand": "Oppo", "description": "OPPO Find X7 Ultra 5G (Black, 256 GB)"},
        {"store": "Reliance Digital", "price": 54499.00, "image": "https://www.reliancedigital.in/medias/Oppo-Find-X7-Ultra-Mobile-Phone.jpg", "category": "phone", "brand": "Oppo", "description": "OPPO Find X7 Ultra 5G 256GB Black"},
        {"store": "Croma", "price": 54499.00, "image": "https://media-ik.croma.com/prod/https://media.croma.com/image/upload/v1/pim/images/imageone/mobile/oppo-find-x7-ultra.png", "category": "phone", "brand": "Oppo", "description": "OPPO Find X7 Ultra (12GB RAM, 256GB, Black)"}
    ],
    "oppo reno 11": [
        {"store": "Amazon", "price": 34999.00, "image": "https://m.media-amazon.com/images/I/61LB+p3XI0L._SL1500_.jpg", "category": "phone", "brand": "Oppo", "description": "OPPO Reno 11 5G (Pearl White, 8GB, 128GB)"},
        {"store": "Flipkart", "price": 33999.00, "image": "https://rukminim2.flixcart.com/image/832/832/mobile/x/o/q/oppo-reno-11-original-imags9zzhzzhgzzq.jpeg", "category": "phone", "brand": "Oppo", "description": "OPPO Reno 11 5G (Pearl White, 128 GB)"},
        {"store": "Reliance Digital", "price": 34499.00, "image": "https://www.reliancedigital.in/medias/Oppo-Reno-11-Mobile-Phone.jpg", "category": "phone", "brand": "Oppo", "description": "OPPO Reno 11 5G 128GB Pearl White"},
        {"store": "Croma", "price": 34499.00, "image": "https://media-ik.croma.com/prod/https://media.croma.com/image/upload/v1/pim/images/imageone/mobile/oppo-reno-11.png", "category": "phone", "brand": "Oppo", "description": "OPPO Reno 11 (8GB RAM, 128GB, Pearl White)"}
    ],
    "vivo x100 pro": [
        {"store": "Amazon", "price": 89999.00, "image": "https://m.media-amazon.com/images/I/61aGx4qadUL._SL1200_.jpg", "category": "phone", "brand": "Vivo", "description": "Vivo X100 Pro 5G (Black, 16GB, 512GB)"},
        {"store": "Flipkart", "price": 88999.00, "image": "https://rukminim2.flixcart.com/image/832/832/xif0q/mobile/b/h/c/-original-imagwu4aqzsnumyg.jpeg", "category": "phone", "brand": "Vivo", "description": "Vivo X100 Pro 5G (Black, 512 GB)"},
        {"store": "Reliance Digital", "price": 89499.00, "image": "https://www.reliancedigital.in/medias/Vivo-X100-Pro-Mobile-Phone.jpg", "category": "phone", "brand": "Vivo", "description": "Vivo X100 Pro 5G 512GB Black"},
        {"store": "Croma", "price": 89499.00, "image": "https://media-ik.croma.com/prod/https://media.croma.com/image/upload/v1/pim/images/imageone/mobile/vivo-x100-pro.png", "category": "phone", "brand": "Vivo", "description": "Vivo X100 Pro (16GB RAM, 512GB, Black)"}
    ],
    "vivo v29": [
        {"store": "Amazon", "price": 32999.00, "image": "https://m.media-amazon.com/images/I/61oWrP4q8KL._SL1200_.jpg", "category": "phone", "brand": "Vivo", "description": "Vivo V29 5G (Blue, 8GB, 128GB)"},
        {"store": "Flipkart", "price": 31999.00, "image": "https://rukminim2.flixcart.com/image/832/832/xif0q/mobile/u/q/f/-original-imagtyw2qdgzcngx.jpeg", "category": "phone", "brand": "Vivo", "description": "Vivo V29 5G (Blue, 128 GB)"},
        {"store": "Reliance Digital", "price": 32499.00, "image": "https://www.reliancedigital.in/medias/Vivo-V29-Mobile-Phone.jpg", "category": "phone", "brand": "Vivo", "description": "Vivo V29 5G 128GB Blue"},
        {"store": "Croma", "price": 32499.00, "image": "https://media-ik.croma.com/prod/https://media.croma.com/image/upload/v1/pim/images/imageone/mobile/vivo-v29.png", "category": "phone", "brand": "Vivo", "description": "Vivo V29 (8GB RAM, 128GB, Blue)"}
    ],
    "oneplus 12": [
        {"store": "Amazon", "price": 64999.00, "image": "https://m.media-amazon.com/images/I/71K84j2O8wL._SL1500_.jpg", "category": "phone", "brand": "OnePlus", "description": "OnePlus 12 5G (Flowy Emerald, 12GB, 256GB)"},
        {"store": "Flipkart", "price": 63999.00, "image": "https://rukminim2.flixcart.com/image/832/832/xif0q/mobile/o/t/a/-original-imagwy8d4g5bj2x2.jpeg", "category": "phone", "brand": "OnePlus", "description": "OnePlus 12 5G (Flowy Emerald, 256 GB)"},
        {"store": "Reliance Digital", "price": 64499.00, "image": "https://www.reliancedigital.in/medias/OnePlus-12-Mobile-Phone.jpg", "category": "phone", "brand": "OnePlus", "description": "OnePlus 12 5G 256GB Flowy Emerald"},
        {"store": "Croma", "price": 64499.00, "image": "https://media-ik.croma.com/prod/https://media.croma.com/image/upload/v1/pim/images/imageone/mobile/oneplus-12.png", "category": "phone", "brand": "OnePlus", "description": "OnePlus 12 (12GB RAM, 256GB, Flowy Emerald)"}
    ],
    "xiaomi 14": [
        {"store": "Amazon", "price": 69999.00, "image": "https://m.media-amazon.com/images/I/61JeYP2xkZL._SL1500_.jpg", "category": "phone", "brand": "Xiaomi", "description": "Xiaomi 14 5G (Black, 12GB, 256GB)"},
        {"store": "Flipkart", "price": 68999.00, "image": "https://rukminim2.flixcart.com/image/832/832/xif0q/mobile/h/v/7/-original-imagxnqpvfktmg8g.jpeg", "category": "phone", "brand": "Xiaomi", "description": "Xiaomi 14 5G (Black, 256 GB)"},
        {"store": "Reliance Digital", "price": 69499.00, "image": "https://www.reliancedigital.in/medias/Xiaomi-14-Mobile-Phone.jpg", "category": "phone", "brand": "Xiaomi", "description": "Xiaomi 14 5G 256GB Black"},
        {"store": "Croma", "price": 69499.00, "image": "https://media-ik.croma.com/prod/https://media.croma.com/image/upload/v1/pim/images/imageone/mobile/xiaomi-14.png", "category": "phone", "brand": "Xiaomi", "description": "Xiaomi 14 (12GB RAM, 256GB, Black)"}
    ],
    "realme gt5": [
        {"store": "Amazon", "price": 35999.00, "image": "https://m.media-amazon.com/images/I/71poFSdDs5L._SL1500_.jpg", "category": "phone", "brand": "Realme", "description": "Realme GT5 5G (White, 8GB, 128GB)"},
        {"store": "Flipkart", "price": 34999.00, "image": "https://rukminim2.flixcart.com/image/832/832/xif0q/mobile/5/r/x/-original-imagtzf4yuhqyzfu.jpeg", "category": "phone", "brand": "Realme", "description": "Realme GT5 5G (White, 128 GB)"},
        {"store": "Reliance Digital", "price": 35499.00, "image": "https://www.reliancedigital.in/medias/Realme-GT5-Mobile-Phone.jpg", "category": "phone", "brand": "Realme", "description": "Realme GT5 5G 128GB White"},
        {"store": "Croma", "price": 35499.00, "image": "https://media-ik.croma.com/prod/https://media.croma.com/image/upload/v1/pim/images/imageone/mobile/realme-gt5.png", "category": "phone", "brand": "Realme", "description": "Realme GT5 (8GB RAM, 128GB, White)"}
    ],
    "sony wh1000xm4": [
        {"store": "Amazon", "price": 24999.00, "image": "https://m.media-amazon.com/images/I/61nnZlMLDxL._SL1500_.jpg", "category": "headphone", "brand": "Sony", "description": "Sony WH-1000XM4 Wireless Noise Cancelling Headphones (Black)"},
        {"store": "Flipkart", "price": 23999.00, "image": "https://rukminim2.flixcart.com/image/832/832/kc2p52w0/headphone/g/h/p/wh-1000xm4-sony-original-imaftb5qpft7zvyc.jpeg", "category": "headphone", "brand": "Sony", "description": "Sony WH-1000XM4 Bluetooth Headset (Black, On the Ear)"},
        {"store": "Croma", "price": 24499.00, "image": "https://media-ik.croma.com/prod/https://media.croma.com/image/upload/v1662703724/Croma%20Assets/Communication/Headphones%20and%20Earphones/Images/221900_0_qd7hrx.png", "category": "headphone", "brand": "Sony", "description": "Sony WH-1000XM4 Wireless Active Noise Cancelling Headphones (Black)"},
        {"store": "Reliance Digital", "price": 24299.00, "image": "https://www.reliancedigital.in/medias/Sony-WH-1000XM4-Headphones-491934076-i-1-1200Wx1200H.jpg", "category": "headphone", "brand": "Sony", "description": "Sony WH-1000XM4 Wireless Noise Cancelling Headphones Black"}
    ],
    "macbook pro 16": [
        {"store": "Amazon", "price": 189999.00, "image": "https://m.media-amazon.com/images/I/61fd2oCrvyL._SL1500_.jpg", "category": "laptop", "brand": "Apple", "description": "Apple 2023 MacBook Pro (16-inch, M3 Pro chip)"},
        {"store": "Flipkart", "price": 188999.00, "image": "https://rukminim2.flixcart.com/image/832/832/xif0q/computer/8/t/6/-original-imagtxvqnv5zhqyr.jpeg", "category": "laptop", "brand": "Apple", "description": "APPLE 2023 MacBook Pro M3 Pro - (16 GB/512 GB SSD/macOS Sonoma)"},
        {"store": "Croma", "price": 189499.00, "image": "https://media-ik.croma.com/prod/https://media.croma.com/image/upload/v1703066340/Croma%20Assets/Computers%20Peripherals/Laptop/Images/302374_yn1bxl.png", "category": "laptop", "brand": "Apple", "description": "Apple 2023 MacBook Pro M3 Pro (16-inch, 16GB, 512GB)"},
        {"store": "Reliance Digital", "price": 188499.00, "image": "https://www.reliancedigital.in/medias/Apple-MPLT3HN-A-Laptops-492850808-i-1-1200Wx1200H.jpg", "category": "laptop", "brand": "Apple", "description": "Apple MacBook Pro 16-inch with M3 Pro Chip"}
    ]
}

def search_products(query):
    """
    Enhanced search function with better matching:
    - Exact brand matches
    - Exact category matches
    - Smart product name matching
    - Prevents irrelevant partial matches
    """
    query = query.lower().strip()
    query_words = set(query.split())
    results = {}

    for product, data in PRODUCT_DATA.items():
        product_lower = product.lower()
        brand = data[0]['brand'].lower()
        category = data[0]['category'].lower()
        description = data[0]['description'].lower()

        # For brand-specific searches (e.g., "vivo phone", "apple laptop")
        if len(query_words) >= 2:
            brand_match = any(word == brand for word in query_words)
            category_match = any(word == category for word in query_words)
            if brand_match and category_match:
                results[product] = data
                continue

        # For specific model and version searches (e.g., "iphone 15 pro", "galaxy s24 ultra")
        # Count how many words from the query match either the product name or description
        matching_words = sum(1 for word in query_words 
                           if word in product_lower or word in description)
        if matching_words >= len(query_words) * 0.75:  # If 75% or more words match
            results[product] = data
            continue

        # For exact brand matches (e.g., "vivo", "apple")
        if query == brand:
            results[product] = data
            continue

        # For exact category matches (e.g., "phone", "laptop")
        if query == category:
            results[product] = data
            continue

    return results